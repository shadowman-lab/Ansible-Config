---
- name: Patch Server
  ansible.builtin.dnf:
    name: '*'
    state: latest
    update_only: true
  async: 1000
  poll: 0
  register: dnf_sleeper

- name: Check Remaining Packages {{ inventory_hostname }}
  ansible.builtin.dnf:
    list: updates
  register: result
  until: result.results | default("False") == []
  retries: 50
  delay: 5

- name: Clear Async Job Status
  ansible.builtin.async_status:
    jid: "{{ dnf_sleeper.ansible_job_id }}"
    mode: cleanup
